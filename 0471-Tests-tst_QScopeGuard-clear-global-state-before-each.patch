From 85694c4419c702e849d943947f424f0abb95238b Mon Sep 17 00:00:00 2001
From: Tim Blechmann <tim.blechmann@qt.io>
Date: Thu, 23 Oct 2025 12:59:39 +0800
Subject: [PATCH 471/553] Tests: tst_QScopeGuard - clear global state before
 each test
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

s_globalState is not cleared before running each individual test. This
causes failures with -repeat

Change-Id: Ia10722b5eda09cc5058949650c4ad541dae89c0d
Reviewed-by: Tor Arne Vestb√∏ <tor.arne.vestbo@qt.io>
(cherry picked from commit c7c4b2b981718a38e13888cacc44c0b3b36c2342)
Reviewed-by: Qt Cherry-pick Bot <cherrypick_bot@qt-project.org>
---
 tests/auto/corelib/tools/qscopeguard/tst_qscopeguard.cpp | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/tests/auto/corelib/tools/qscopeguard/tst_qscopeguard.cpp b/tests/auto/corelib/tools/qscopeguard/tst_qscopeguard.cpp
index b7c2b952e2d..e7e66d6affc 100644
--- a/tests/auto/corelib/tools/qscopeguard/tst_qscopeguard.cpp
+++ b/tests/auto/corelib/tools/qscopeguard/tst_qscopeguard.cpp
@@ -25,6 +25,8 @@ private Q_SLOTS:
     void optionalGuard();
     void leavingScope();
     void exceptions();
+
+    void init();
 };
 
 void func()
@@ -154,7 +156,6 @@ void tst_QScopeGuard::leavingScope()
 
 void tst_QScopeGuard::exceptions()
 {
-    s_globalState = 0;
     bool caught = false;
     QT_TRY
     {
@@ -172,5 +173,10 @@ void tst_QScopeGuard::exceptions()
 
 }
 
+void tst_QScopeGuard::init()
+{
+    s_globalState = 0;
+}
+
 QTEST_MAIN(tst_QScopeGuard)
 #include "tst_qscopeguard.moc"
-- 
2.51.2

