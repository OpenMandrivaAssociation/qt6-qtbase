From 48599fd4070aa745920f9e6910b006b478323114 Mon Sep 17 00:00:00 2001
From: Laszlo Agocs <laszlo.agocs@qt.io>
Date: Tue, 9 Sep 2025 13:21:31 +0200
Subject: [PATCH 115/553] Bail out on null swapchain in rhi flush
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Avoid crashing. There is already an early return for a null rhi,
do the same for the swapchain.

Task-number: QTBUG-139994
Pick-to: 6.9 6.8
Change-Id: Idb6d957236f60ae0b8356e24ecda3b6f566ed95f
Reviewed-by: Tor Arne Vestb√∏ <tor.arne.vestbo@qt.io>
(cherry picked from commit 8f4430a2121a1961a991b79cd97a1ef13d47ea96)
Reviewed-by: Qt Cherry-pick Bot <cherrypick_bot@qt-project.org>
---
 src/gui/painting/qbackingstoredefaultcompositor.cpp | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/gui/painting/qbackingstoredefaultcompositor.cpp b/src/gui/painting/qbackingstoredefaultcompositor.cpp
index 41ab7c97f8c..fae9dabca66 100644
--- a/src/gui/painting/qbackingstoredefaultcompositor.cpp
+++ b/src/gui/painting/qbackingstoredefaultcompositor.cpp
@@ -463,7 +463,7 @@ QPlatformBackingStore::FlushResult QBackingStoreDefaultCompositor::flush(QPlatfo
                                                                          bool translucentBackground,
                                                                          qreal sourceTransformFactor)
 {
-    if (!rhi)
+    if (!rhi || !swapchain)
         return QPlatformBackingStore::FlushFailed;
 
     // Note, the sourceTransformFactor is different from the sourceDevicePixelRatio,
-- 
2.51.2

