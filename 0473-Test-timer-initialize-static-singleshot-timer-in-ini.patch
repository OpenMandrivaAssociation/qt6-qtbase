From 1b2841608a49db0872251585403795e290ab083a Mon Sep 17 00:00:00 2001
From: Tim Blechmann <tim.blechmann@qt.io>
Date: Thu, 23 Oct 2025 14:05:09 +0800
Subject: [PATCH 473/553] Test: timer - initialize static singleshot timer in
 initTestCase
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

The helper object should be constructed/destructed symetrically in
initTestCase/cleanupTestCase.
Fixes a crash when using -repeat

Change-Id: I9a78799577d7a6beac4c787f2581872ef134ba7f
Reviewed-by: Tor Arne Vestb√∏ <tor.arne.vestbo@qt.io>
(cherry picked from commit 80c96ded7a18f6f0c9df79a912cbbc3c5b9e9e95)
Reviewed-by: Qt Cherry-pick Bot <cherrypick_bot@qt-project.org>
---
 tests/auto/corelib/kernel/qtimer/tst_qtimer.cpp | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/tests/auto/corelib/kernel/qtimer/tst_qtimer.cpp b/tests/auto/corelib/kernel/qtimer/tst_qtimer.cpp
index adff512e6a3..81316b061d0 100644
--- a/tests/auto/corelib/kernel/qtimer/tst_qtimer.cpp
+++ b/tests/auto/corelib/kernel/qtimer/tst_qtimer.cpp
@@ -45,11 +45,11 @@ using namespace std::chrono_literals;
 class tst_QTimer : public QObject
 {
     Q_OBJECT
-public:
-    static void initMain();
 
 private slots:
+    void initTestCase();
     void cleanupTestCase();
+
     void zeroTimer();
     void singleShotTimeout();
     void timeout();
@@ -1678,11 +1678,11 @@ struct StaticSingleShotUser
 };
 
 // NOTE: to prevent any static initialization order fiasco, we implement
-//       initMain() to instantiate staticSingleShotUser before qApp
+//       initTestCase() to instantiate staticSingleShotUser before qApp
 
 static StaticSingleShotUser *s_staticSingleShotUser = nullptr;
 
-void tst_QTimer::initMain()
+void tst_QTimer::initTestCase()
 {
     s_staticSingleShotUser = new StaticSingleShotUser;
 }
-- 
2.51.2

