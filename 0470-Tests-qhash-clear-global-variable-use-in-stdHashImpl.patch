From 197dda3a578113e0eee3a26d2ba8a4295d1065ed Mon Sep 17 00:00:00 2001
From: Tim Blechmann <tim.blechmann@qt.io>
Date: Thu, 23 Oct 2025 12:56:44 +0800
Subject: [PATCH 470/553] Tests: qhash - clear global variable use in
 stdHashImpl
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

`StdHashUsed` is set in the stdHashImpl, but the test does not ensure
that it is initialized before the test. This causes test failures with
-repeat.
Clearing the flag at the beginning of the test function fixes this
behaviour.

Change-Id: I383611ce9368c6826cb5436a74e12bd73748491c
Reviewed-by: Tor Arne Vestb√∏ <tor.arne.vestbo@qt.io>
(cherry picked from commit c04f85e4e02e2fb99d7fe8c766a097c4d9cf8083)
Reviewed-by: Qt Cherry-pick Bot <cherrypick_bot@qt-project.org>
---
 tests/auto/corelib/tools/qhash/tst_qhash.cpp | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/tests/auto/corelib/tools/qhash/tst_qhash.cpp b/tests/auto/corelib/tools/qhash/tst_qhash.cpp
index b03750389bd..8ec9cb516d3 100644
--- a/tests/auto/corelib/tools/qhash/tst_qhash.cpp
+++ b/tests/auto/corelib/tools/qhash/tst_qhash.cpp
@@ -3153,6 +3153,8 @@ qHash(const StdHashKeyType<HasQHash> &s, size_t seed)
 template <typename T>
 void stdHashImpl()
 {
+    T::StdHashUsed = false;
+
     QHash<T, int> hash;
     for (int i = 0; i < 1000; ++i)
         hash.insert(T{i}, i);
-- 
2.51.2

