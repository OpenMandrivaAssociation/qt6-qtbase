From 7fd02fc67019e43ff2266fb6ccaae2cf1fe1348f Mon Sep 17 00:00:00 2001
From: Morteza Jamshidi <morteza.jamshidi@qt.io>
Date: Tue, 26 Aug 2025 09:45:04 +0200
Subject: [PATCH 009/553] QDialog: Add missing attribute set for explicit hide
 and show
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Due to setVisible function being overrided in the QDialog and after
this commit 79be5fa98663ca6b7e905ecb08950f17ccc06e98, the logic for
setting WA_WState_ExplicitShowHide attribute was never called.
It seems like that's the only logic missing from QWidget::setVisible
function so instead of adding the logic here, we call the base
function.

Fixes: QTBUG-139291
Change-Id: I287b4daca3cd682a20aeb8bf4b5ada7eeab2ab19
Pick-to: 6.9 6.8
Reviewed-by: Tor Arne Vestb√∏ <tor.arne.vestbo@qt.io>
(cherry picked from commit 3f853f79a6f349ff47dd29a1be924007042ef8d5)
Reviewed-by: Qt Cherry-pick Bot <cherrypick_bot@qt-project.org>
---
 src/widgets/dialogs/qdialog.cpp | 7 +------
 1 file changed, 1 insertion(+), 6 deletions(-)

diff --git a/src/widgets/dialogs/qdialog.cpp b/src/widgets/dialogs/qdialog.cpp
index ff3e672eeed..90df7bf5453 100644
--- a/src/widgets/dialogs/qdialog.cpp
+++ b/src/widgets/dialogs/qdialog.cpp
@@ -749,12 +749,7 @@ void QDialog::closeEvent(QCloseEvent *e)
 
 void QDialog::setVisible(bool visible)
 {
-    Q_D(QDialog);
-
-    if (testAttribute(Qt::WA_WState_ExplicitShowHide) && testAttribute(Qt::WA_WState_Hidden) != visible)
-        return;
-
-    d->setVisible(visible);
+    QWidget::setVisible(visible);
 }
 
 void QDialogPrivate::setVisible(bool visible)
-- 
2.51.2

