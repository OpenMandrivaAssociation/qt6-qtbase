From 491ac58e3d24ffb2a7acd4a53e277aade6909d27 Mon Sep 17 00:00:00 2001
From: Assam Boudjelthia <assam.boudjelthia@qt.io>
Date: Wed, 8 Oct 2025 12:50:58 +0300
Subject: [PATCH 399/553] Android: don't check keyboard visibility in
 hasValidFocusObject()
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Don't check for keyboard visibility when checking for a valid focus
object under QAndroidInputContext before running actions on the
Android thread. because the keyboard is not immediately visible
after being reqeusted, some actions might end up being dropped
at the beginning, and the other checks we have already should
cover cases to avoid calling those actions on non-valid input
object.

Partially reverts c8a1e7bb37863ccf1d5859f36841a350060aaddf.

Fixes: QTBUG-140856
Pick-to: 6.8 6.5
Change-Id: Ic3bc43f50aa0ef9ac46b4bb2e490c8be5d560619
Reviewed-by: Konsta Alaj√§rvi <konsta.alajarvi@qt.io>
Reviewed-by: Ville Voutilainen <ville.voutilainen@qt.io>
(cherry picked from commit f5308a9bdde3eded95ea916f85c46f9c6ad9d402)
Reviewed-by: Qt Cherry-pick Bot <cherrypick_bot@qt-project.org>
---
 src/plugins/platforms/android/qandroidinputcontext.cpp | 3 ---
 1 file changed, 3 deletions(-)

diff --git a/src/plugins/platforms/android/qandroidinputcontext.cpp b/src/plugins/platforms/android/qandroidinputcontext.cpp
index ecbbddb2e36..1d755139b46 100644
--- a/src/plugins/platforms/android/qandroidinputcontext.cpp
+++ b/src/plugins/platforms/android/qandroidinputcontext.cpp
@@ -82,9 +82,6 @@ static bool hasValidFocusObject()
     if (!m_androidInputContext)
         return false;
 
-    if (!m_androidInputContext->isInputPanelVisible())
-        return false;
-
     const auto focusObject = m_androidInputContext->focusObject();
     if (!focusObject)
         return false;
-- 
2.51.2

